
[gcode_macro CANCEL_PRINT]
description: Cancel the actual running print
rename_existing: CANCEL_PRINT_BASE
gcode:
    PRINT_END
    CANCEL_PRINT_BASE {rawparams}

[gcode_macro PAUSE]
rename_existing: PAUSE_BASE
gcode:
    SAVE_GCODE_STATE NAME=PAUSE_state
    PAUSE_BASE {rawparams}
    G91
    G1 E-2 F1200
    G1 Z50
    G90
    G1 X0 Y0 F6000
	
[gcode_macro RESUME]
rename_existing: RESUME_BASE
gcode:
    RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1
    G91
    G1 E2 F1200
    G90
    RESUME_BASE {rawparams}

[gcode_macro LOAD_FILAMENT]
gcode:
    {% set cooldown = printer.extruder.target<=0 %}
    {% if printer.extruder.target<200 %}
        {% set temp=params.TEMP|default(230) %}
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={temp}
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={temp-10}
    {% else %}
        {% set temp=printer.extruder.target %}
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={temp}
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={temp-10}
    {% endif %}
    G91
    G1 E40 F3000
    G1 E40 F300
    G90
    {% if cooldown %}
        SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET=0
    {% endif %}

[gcode_macro UNLOAD_FILAMENT]
gcode:
    {% set cooldown = printer.extruder.target<=0 %}
    {% if not printer.extruder.target %}
        {% set temp=params.TEMP|default(printer.configfile.settings.extruder.min_extrude_temp) %}
    {% else %}
        {% set temp=printer.extruder.target %}
    {% endif %}
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET={temp}
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={temp}
    G91
    G1 E-40 F600
    G1 E-40 F3000
    G90
    {% if cooldown %}
        SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET=0
    {% endif %}
